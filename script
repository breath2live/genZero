# import
from strategy import strategy
import indicator

# start script
showMe('starting script', id)

# load bigdata
if stock is None: loadstock()
#if option is None: loadoption()

# build indicator
#ind = pd.DataFrame([], index=pd.DatetimeIndex(stock.index))
ind = stock.copy()
ind['MA20'] = indicator.getMA(stock['close'], window=20)
ind['MA50'] = indicator.getMA(stock['close'], window=50)
ind['marank'] = indicator.getRank(ind['MA20']-ind['MA50'], window=50)
ind['ivrank50'] = indicator.getRank(stock['iv-close'], window=50)

# create strategy
strat = strategy()
strat.setStock(stock)
#strat.setOption(option)
strat.setIndicator(ind)
strat.addTrigger('date', "self.newWeek()")
strat.addTrigger('ivrank', "self.indicatorData('ivrank50') > 50")
strat.addTrigger('direction', "self.indicatorData('MA20') > self.indicatorData('MA50')")
strat.addExecution('info', "showMe(self.metadata.name, self.date)")
strat.runDates(enddate='2020-04-01')










# end script
showMe('ending script', id)
